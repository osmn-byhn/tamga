import{n as e,t}from"./index-BD8aEs2b.js";function n(e){if(!e.startsWith(`otpauth-migration://`))throw Error(`Invalid migration URI`);let t=new URL(e).searchParams.get(`data`);if(!t)throw Error(`No data found in migration URI`);let n=atob(t),i=new Uint8Array(n.length);for(let e=0;e<n.length;e++)i[e]=n.charCodeAt(e);return r(i)}function r(n){let r=[],s=0;for(;s<n.length;){let e=n[s++],t=e&7;if(e>>3==1&&t===2){let e=a(n,s);s=e.nextPos;let t=n.slice(s,s+e.value);r.push(i(t)),s+=e.value}else s=o(n,s,t)}return r.map(n=>{try{return new e({issuer:n.issuer||n.name.split(`:`)[0]||`Unknown`,label:n.name||`Account`,algorithm:n.algorithm||`SHA1`,digits:n.digits||6,period:30,secret:new t({buffer:n.secret})}).toString()}catch(e){return console.error(`Failed to convert parameters to TOTP:`,e,n),null}}).filter(e=>e!==null)}function i(e){let t={secret:null,name:``,issuer:``,algorithm:`SHA1`,digits:6,type:`TOTP`},n=0;for(;n<e.length;){let r=e[n++],i=r&7,s=r>>3;if(s===1&&i===2){let r=a(e,n);n=r.nextPos,t.secret=e.slice(n,n+r.value),n+=r.value}else if(s===2&&i===2){let r=a(e,n);n=r.nextPos,t.name=new TextDecoder().decode(e.slice(n,n+r.value)),n+=r.value}else if(s===3&&i===2){let r=a(e,n);n=r.nextPos,t.issuer=new TextDecoder().decode(e.slice(n,n+r.value)),n+=r.value}else if(s===4&&i===0){let r=a(e,n);n=r.nextPos,t.algorithm=[`INVALID`,`SHA1`,`SHA256`,`SHA512`,`MD5`][r.value]||`SHA1`}else if(s===5&&i===0){let r=a(e,n);n=r.nextPos,t.digits=r.value===1?6:r.value===2?8:6}else n=o(e,n,i)}return t}function a(e,t){let n=0,r=0;for(;;){let i=e[t++];if(n|=(i&127)<<r,!(i&128))break;r+=7}return{value:n,nextPos:t}}function o(e,t,n){if(n===0)for(;e[t++]&128;);else if(n===2){let n=a(e,t);t=n.nextPos+n.value}else n===1?t+=8:n===5&&(t+=4);return t}export{n as decodeMigrationUri};